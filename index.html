<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="计算巢是阿里云开放给企业应用服务商的服务管理平台。服务商能够在计算巢上发布私有化部署服务，为其客户提供云上软件一键部署的能力；同时也支持全托管模式的服务，赋能服务商托管其客户资源。">
  <title>ROS自定义资源服务实例部署文档 - Aliyun 计算巢 x quickstart-ros-custom-resource</title>

  <link rel="shortcut icon" href="img/favicon.ico">

  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css">
  <link rel="stylesheet" href="css/theme.css">
  

  

  
  

  
    <script src="search/main.js"></script>
  

  

  <script src="js/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
</head>

<body>
  <div class="container">
    <div class="nav">
      <div class="nav-inner">
        <div class="logo">
          <img src="./img/logo-2x.png">
        </div>
        <div class="nav-list">
          <ul>
          
              <li><a href="#ros">ROS自定义资源服务实例部署文档</a></li>
              
                  <li><a href="#_1">概述</a></li>
                  
              
                  <li><a href="#_2">计费说明</a></li>
                  
              
                  <li><a href="#_3">部署架构</a></li>
                  
              
                  <li><a href="#ram">RAM账号所需权限</a></li>
                  
              
                  <li><a href="#_4">部署流程</a></li>
                  
                      <li class="li-h3"><a href="#_5">部署步骤</a></li>
                  
                      <li class="li-h3"><a href="#_6">部署参数说明</a></li>
                  
                      <li class="li-h3"><a href="#_7">验证结果</a></li>
                  
                      <li class="li-h3"><a href="#_8">同步仓库代码到自定义资源模块</a></li>
                  
                      <li class="li-h3"><a href="#_9">自定义资源模块使用示例</a></li>
                  
              
                  <li><a href="#_10">帮助文档</a></li>
                  
              
          
          </ul>
        </div>
      </div>
    </div>
    <div class="content theme-github">
      
      <div class="content-inner">        
        
        <h1 id="ros">ROS自定义资源服务实例部署文档</h1>
<h2 id="_1">概述</h2>
<p>阿里云资源编排服务ROS（Resource Orchestration Service）可以帮助您简化云计算资源的管理。 
遵循ROS定义的模板规范，您可以定义所需云计算资源的集合及资源间的依赖关系。
ROS可以自动完成所有资源的创建和配置，实现自动化部署和运维。</p>
<p>ROS不仅能够编排阿里云资源，还支持自定义资源。
使用自定义资源，您可以在模板中编写自定义配置逻辑。
当您创建、更新（如果您更改了自定义资源）或删除资源栈时，ROS会运行该逻辑。</p>
<p><code>ROS自定义资源</code>服务可以把GitHub代码仓库（Python语言）构建和部署为ROS自定义资源，并输出ROS模块，方便后续使用。</p>
<p>本文向您介绍如何开通计算巢上的<code>ROS自定义资源</code>服务，以及部署流程和使用说明。</p>
<h2 id="_2">计费说明</h2>
<p><code>ROS自定义资源</code>服务在计算巢上的费用主要涉及：</p>
<ul>
<li><a href="https://help.aliyun.com/zh/oss/product-overview/billing-overview">对象存储OSS费用</a>：构建好的代码包会放在OSS中。计费项涉及存储、流量和请求。</li>
<li><a href="https://help.aliyun.com/document_detail/173288.html">云效费用</a>：会创建和执行流水线。基础版免费，但有限额。</li>
<li><a href="https://help.aliyun.com/zh/fc/product-overview/billing-overview">函数计算</a>：部署服务不产生此项费用，后续使用构建好的自定义资源或模块时会产生此项费用。计费项涉及函数调用、资源使用、公网出流量。首次开通前3个月有试用额度。</li>
</ul>
<h2 id="_3">部署架构</h2>
<p>如下图所示，计算巢会进行如下部署：
- 创建OSS存储桶、函数计算服务和函数、云效流水线等资源。
- 执行云效流水线：下载GitHub代码、构建代码包、上传到OSS存储桶、部署到函数计算函数。
- 适配函数计算函数为ROS自定义资源，把ROS自定义资源封装为ROS模块，供后续使用。</p>
<p>GitHub代码更新后，可以手动触发或通过GitHub Workflow自动触发云效流水线。</p>
<p><img src="arch.jpg" width="1000" align="bottom"/></p>
<h2 id="ram">RAM账号所需权限</h2>
<p><code>ROS自定义资源</code>服务需要对OSS、FC、RDC、ECS、RAM等服务的资源进行访问和创建操作，若您使用RAM用户创建服务实例，需要在创建服务实例前，对使用的RAM用户的账号添加相应资源的权限。添加RAM权限的详细操作，请参见<a href="https://help.aliyun.com/document_detail/121945.html">为RAM用户授权</a>。所需权限如下表所示。</p>
<table>
<thead>
<tr>
<th>权限策略名称</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>AliyunOSSFullAccess</td>
<td>管理对象存储服务(OSS)权限</td>
</tr>
<tr>
<td>AliyunFCFullAccess</td>
<td>管理函数计算(FC)服务的权限</td>
</tr>
<tr>
<td>AliyunRDCFullAccess</td>
<td>管理云效(RDC)的权限</td>
</tr>
<tr>
<td>AliyunECSReadOnlyAccess</td>
<td>只读访问云服务器服务(ECS)的权限</td>
</tr>
<tr>
<td>AliyunRAMFullAccess</td>
<td>管理访问控制(RAM)的权限，即管理用户以及授权的权限。如果缺少角色AliyunFcDefaultRole、AliyunRDCDefaultRole则需要此权限创建角色。否则只需要AliyunRAMReadOnlyAccess权限。</td>
</tr>
<tr>
<td>AliyunROSFullAccess</td>
<td>管理资源编排服务(ROS)的权限</td>
</tr>
<tr>
<td>AliyunComputeNestUserFullAccess</td>
<td>管理计算巢服务（ComputeNest）的用户侧权限</td>
</tr>
</tbody>
</table>
<h2 id="_4">部署流程</h2>
<h3 id="_5">部署步骤</h3>
<p>1.单击<a href="https://computenest.console.aliyun.com/user/cn-hangzhou/serviceInstanceCreate?ServiceId=service-8d6d94f064d64f9892d0">部署链接</a>，进入服务实例部署界面，根据界面提示，填写参数完成部署。</p>
<p>2.在<strong>创建服务实例</strong>页，配置部署参数。</p>
<p><img src="param-1.jpg" width="1000" align="bottom"/></p>
<p><img src="param-2.jpg" width="1000" align="bottom"/></p>
<p><img src="param-3.jpg" width="1000" align="bottom"/></p>
<p><img src="param-4.jpg" width="1000" align="bottom"/></p>
<p><img src="param-5.jpg" width="1000" align="bottom"/></p>
<p>3.点击下一步：确认订单。</p>
<p>4.查看订单页，确保依赖检查全部正常，点击立即创建。</p>
<p><img src="dep.jpg" width="1000" align="bottom"/></p>
<h3 id="_6">部署参数说明</h3>
<table>
<thead>
<tr>
<th>参数组</th>
<th>参数项</th>
<th>示例</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>服务实例名称</td>
<td></td>
<td>ros-custom-resource-test</td>
<td>实例的名称</td>
</tr>
<tr>
<td>地域</td>
<td></td>
<td>华北2（北京）</td>
<td>选中服务实例的地域，建议就近选中，以获取更好的网络延时。</td>
</tr>
<tr>
<td>代码配置</td>
<td>GitHub代码仓库地址</td>
<td>https://github.com/aliyun-computenest/quickstart-ros-custom-resource.git</td>
<td>建议从<a href="https://github.com/aliyun-computenest/quickstart-ros-custom-resource">示例代码仓库</a>fork。</td>
</tr>
<tr>
<td>代码配置</td>
<td>GitHub代码仓库分支</td>
<td>main</td>
<td>要使用的分支。</td>
</tr>
<tr>
<td>代码配置</td>
<td>Python版本</td>
<td>python3.9</td>
<td>Python版本。</td>
</tr>
<tr>
<td>云效配置</td>
<td>云效企业</td>
<td>6542ffd18281<strong><em>*</em></strong><strong>*</strong></td>
<td>下拉选择或者创建。</td>
</tr>
<tr>
<td>云效配置</td>
<td>云效GitHub服务连接</td>
<td>re6dh9rs<strong><em>*</em></strong>*</td>
<td>下拉选择或者创建。</td>
</tr>
<tr>
<td>自定义资源配置</td>
<td>自定义资源类名</td>
<td>Example1</td>
<td>使用<a href="https://github.com/aliyun-computenest/quickstart-ros-custom-resource">示例代码仓库</a>或其fork的代码仓库构建自定义资源时，需要指定具体要使用的自定义资源类名。自定义资源类具体指BaseCustomResource（位于common模块）的子类。在示例代码仓库中有2个自定义资源类，Example1和Example2（位于custom_resource.example模块）。指定模块使用的自定义资源类，后续使用模块时不可变。</td>
</tr>
<tr>
<td>自定义资源配置</td>
<td>模块名称</td>
<td>MODULE::MyOrg::MyService::Example1</td>
<td>把自定义资源输出为ROS模块时，需要指定模块的名称。</td>
</tr>
<tr>
<td>自定义资源配置</td>
<td>资源动作执行超时时间</td>
<td>300</td>
<td>包括创建、更新和删除。 默认300秒。最小1秒，最大43200秒。</td>
</tr>
<tr>
<td>更多配置</td>
<td>名称前缀</td>
<td>ros-custom-resource</td>
<td>用于OSS存储桶、FC服务、云效服务连接、云效流水线。</td>
</tr>
<tr>
<td>更多配置</td>
<td>OSS存储桶名称</td>
<td>my-bucket</td>
<td>用于存放构建好的自定义资源的代码包。若不设置则会自动创建。</td>
</tr>
<tr>
<td>更多配置</td>
<td>是否删除OSS存储桶</td>
<td>true</td>
<td>删除OSS存储桶会删除里面的所有文件。仅删除自动创建的OSS存储桶。</td>
</tr>
<tr>
<td>更多配置</td>
<td>流水线超时时间</td>
<td>5</td>
<td>云效流水线执行超时时间。单位分钟，默认5分钟。</td>
</tr>
</tbody>
</table>
<h3 id="_7">验证结果</h3>
<p>1.查看服务实例。服务实例创建成功后，部署时间大约需要2分钟。部署完成后，页面上可以看到对应的服务实例。点击服务实例，进入<strong>服务实例详情</strong>页面。</p>
<p><img src="instance-1.jpg" width="1000" align="bottom"/></p>
<p>2.查看<strong>服务实例详情</strong>页面中的<strong>实例信息</strong>，点击<strong>ModuleURL</strong>处链接（红框处），进入<strong>模块详情</strong>页面。</p>
<p><img src="instance-2.jpg" width="1000" align="bottom"/></p>
<p>3.查看<strong>模块详情</strong>页面，选择<strong>模板示例</strong>标签页，点击<strong>创建资源栈</strong>，进入<strong>创建资源栈</strong>页面。</p>
<p><img src="module.jpg" width="1000" align="bottom"/></p>
<p>4.在<strong>创建资源栈</strong>页面点击<strong>创建</strong>按钮，进入<strong>资源栈详情</strong>页面。</p>
<p><img src="stack-1.jpg" width="1000" align="bottom"/></p>
<p>5.在<strong>资源栈详情</strong>页面，等待几秒钟，点击刷新按钮，等待资源栈创建完成。创建完成后，选择<strong>输出</strong>标签页。如果结果类似下图，则表明自定义资源模块部署成功，后续可以在其他模板中使用。</p>
<p><img src="stack-2.jpg" width="1000" align="bottom"/></p>
<h3 id="_8">同步仓库代码到自定义资源模块</h3>
<p>查看<strong>服务实例详情</strong>页面中的<strong>实例信息</strong>，点击<strong>PipelineURL</strong>处链接（蓝框处），可以访问云效流水线。</p>
<p><img src="instance-2.jpg" width="1000" align="bottom"/></p>
<p>如果仓库中的代码更新了，您可以点击<strong>运行</strong>按钮运行流水线以更新自定义资源模块。</p>
<p><img src="pipeline.jpg" width="1000" align="bottom"/></p>
<p>您也可以配置GitHub Workflow，在代码更新后触发云效流水线，实现自动进行同步。</p>
<h3 id="_9">自定义资源模块使用示例</h3>
<p>查看<strong>服务实例详情</strong>页面中的<strong>实例信息</strong>，SampleTemplate处的模板为自定义资源模块的使用示例。您可以参考使用，也可以直接复制使用。</p>
<p><img src="instance-2.jpg" width="1000" align="bottom"/></p>
<h2 id="_10">帮助文档</h2>
<ul>
<li><a href="https://help.aliyun.com/zh/ros/user-guide/module">ROS模块</a></li>
<li><a href="https://help.aliyun.com/document_detail/145907.html">ROS自定义资源</a></li>
<li><a href="https://help.aliyun.com/document_detail/145579.html">ALIYUN::ROS::CustomResource</a></li>
<li><a href="https://developer.aliyun.com/article/740364">资源编排ROS之自定制资源（基础篇）</a></li>
<li><a href="https://developer.aliyun.com/article/740198">资源编排ROS之自定制资源（多云部署AWS篇）</a></li>
<li><a href="https://developer.aliyun.com/article/740363">资源编排ROS之自定制资源（多云部署Terraform篇）</a></li>
</ul>
        
      </div>

      <div class="copyrights">© 2009-2022 Aliyun.com 版权所有</div>
    </div>
  </div>
  
  <!--
  MkDocs version      : 1.5.3
  Docs Build Date UTC : 2023-11-09 11:52:24.979865+00:00
  -->
</body>
</html>